node('ie1tqabld02') 
{
	def msbuild = tool 'v15';
	def version = VersionNumber projectStartDate: '', skipFailedBuilds: true, versionNumberString: '${BUILDS_ALL_TIME}', versionPrefix: '1.0.1.'
	
	currentBuild.setDisplayName(version)
	
	stage('\u269B Build')
	{
		checkout scm
		bat 'nuget restore AutomationFramework.sln'
			
		bat "\"${msbuild}\" AutomationFramework.sln /p:Configuration=Release"
		bat "\"${msbuild}\" AutomationFramework.sln /p:Configuration=Chrome"
		bat "\"${msbuild}\" AutomationFramework.sln /p:Configuration=Firefox"
		bat "\"${msbuild}\" AutomationFramework.sln /p:Configuration=InternetExplorer"
		bat "\"${msbuild}\" AutomationFramework.sln /p:Configuration=Android"
		bat "\"${msbuild}\" AutomationFramework.sln /p:Configuration=iOS"
		
		openTasks canComputeNew: false, defaultEncoding: '', excludePattern: '', healthy: '', high: 'FIXME', low: 'TBD', normal: 'TODO', pattern: '**/*.cs, **/*.feature', unHealthy: ''
	}
	
	stage('\u2622 Unit Tests')
	{
		bat 'nunit Fourth.Automation.Framework.Unit/bin/Release/Fourth.Automation.Framework.Unit.dll --result:TestResults/UnitTestResults.xml;format=nunit2'
		archiveArtifacts artifacts: 'TestResults/UnitTestResults.xml'
        step([$class: 'NUnitPublisher', testResultsPattern: 'TestResults/UnitTestResults.xml', debug: false, keepJUnitReports: true, skipJUnitArchiver:false, failIfNoResults: true])		
	}
	
	stage('\u2622 Test - Chrome')
	{
		bat 'nunit Fourth.Automation.Framework.Functional/bin/Chrome/Fourth.Automation.Framework.Functional.dll --result:TestResults/ChromeTestResults.xml;format=nunit2'
		archiveArtifacts artifacts: 'TestResults/ChromeTestResults.xml'
        step([$class: 'NUnitPublisher', testResultsPattern: 'TestResults/ChromeTestResults.xml', debug: false, keepJUnitReports: true, skipJUnitArchiver:false, failIfNoResults: true])
	}
	
	stage('\u2622 Test - Firefox')
	{
		bat 'nunit Fourth.Automation.Framework.Functional/bin/Firefox/Fourth.Automation.Framework.Functional.dll --result:TestResults/FirefoxTestResults.xml;format=nunit2'
		archiveArtifacts artifacts: 'TestResults/FirefoxTestResults.xml'
        step([$class: 'NUnitPublisher', testResultsPattern: 'TestResults/FirefoxTestResults.xml', debug: false, keepJUnitReports: true, skipJUnitArchiver:false, failIfNoResults: true])
	}
}